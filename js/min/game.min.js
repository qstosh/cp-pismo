function CpGame(){}function CpGameSketch(e,n){this._container=this.$(e),this._endpoint=n}CpGame.prototype.$=jQuery,CpGame.prototype.init=Cp.noop,Cp.inherits(CpGameSketch,CpGame),CpGameSketch.prototype._initCanvas=function(){this._canvas=new fabric.Canvas(this._container.find(".sketch-board")[0],{isDrawingMode:!0});var e=this._canvas;e.on("after:render",function(){e.calcOffset()}),fabric.Object.prototype.transparentCorners=!1;{var n=this.$;this._container.find(".clear-canvas")}this._container.find(".clear-canvas").click(function(){e.clear()}),this._container.find(".drawing-color").change(function(){e.freeDrawingBrush.color=n(this).val()}).trigger("change"),this._container.find(".drawing-line-width").change(function(){e.freeDrawingBrush.width=parseInt(n(this).val(),10)||1,this.previousSibling.innerHTML=n(this).val()}).trigger("change"),this._container.find(".set-drawing-line-width").click(function(){e.freeDrawingBrush.width=n(this).data("width")}),this._container.find(".set-drawing-line-color").click(function(){e.freeDrawingBrush.color=n(this).data("color")})},CpGameSketch.prototype._initWS=function(){this._ws&&this._ws.close(),this._ws=new CpWebsocket(this._endpoint),this._container.find(".sketch-screen, .write-screen, .results-screen").hide();var e=this;e._ws.ready(function(){e._ws.onMessage(function(n){var t=CpGameSketch.prototype["_handle"+CpString.ucfirst(n.type)];if(!Cp.isFunction(t))throw new TypeError("Missing handler for type : "+n.type);t.call(e,n)}),e._ws.onError(function(){}),e._ws.send({method:"clients"}),e._ws.send({method:"state",name:null})}),this._container.find(".ready-btn").one("click",function(){e._ws.send({method:"state",ready:!0})}),this._tickService=new CpWebsocketTickService(e._ws),this._tickService.enable()},CpGameSketch.prototype.init=function(){this._container.find(".sketch-screen, .write-screen, .results-screen").hide(),this._initWS(),this._initCanvas()},CpGameSketch.prototype._handleClientList=function(e){var n=this._container.find(".clients");n.html(""),Cp.each(e.clients,function(e,t){var i=this.$("<img></img>",{src:"http://www.placecage.com/299/"+parseInt(t.player_id%40+300),alt:t.name||"Nieznany",title:t.name||"Nieznany","class":"avatar"}),a=this.$("<div></div>",{"class":t.ready?"ready":""});n.append(a.append(i))}.bind(this))},CpGameSketch.prototype._handleClientDescription=function(e){this._clientDesc=e,this._container.find(".name").text(e.name)},CpGameSketch.prototype._handleSketchTurn=function(e){this._container.find(".welcome-screen, .write-screen").hide();var n=this._container.find(".sketch-screen").show();this._canvas.clear();var t=this;n.find(".word").text(e.word),n.find(".complete-btn").one("click",function(){t._ws.send({method:"saveResponse",data:t._container.find("canvas")[0].toDataURL()})})},CpGameSketch.prototype._handleWriteTurn=function(e){this._container.find(".welcome-screen, .sketch-screen").hide();var n=this._container.find(".write-screen").show(),t=n.find("img"),i=this._container.find("[data-chain-id="+e.queue_id+"] *").eq(e.num);t.attr("src",i.attr("src")),n.find("input").val("");var a=this;n.find(".complete-btn").one("click",function(){a._ws.send({method:"saveResponse",data:n.find("input").val()})})},CpGameSketch.prototype._handleSketchDataShare=function(e){var n=this._container.find(".results-screen .results"),t=n.children("[data-chain-id="+e.queue_id+"]");t.length||(t=this.$("<div></div>",{"data-chain-id":e.queue_id,"class":"answers-chain"}),n.append(t)),t.append(e.is_sketch_turn?this.$("<img />",{src:e.data,"data-player_id":e.player_id,"data-turn":e.turn}):this.$("<span />",{"data-player_id":e.player_id,"data-turn":e.turn}).text(e.data))},CpGameSketch.prototype._handleSketchFinish=function(){this._container.find(".sketch-screen, .write-screen").hide(),this._container.find(".results-screen").show();var e=this;this._container.find(".restart-btn").on("click",function(){e._container.find(".results-screen").hide(),e._container.find(".welcome-screen").show(),e._initWS(),e._container.find(".results-screen .results").html("")})};